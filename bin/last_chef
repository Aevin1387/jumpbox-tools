#!/usr/bin/perl

use strict;
use warnings;

use Date::Parse;

open(my $chef_log, '<', '/var/log/chef/client.log')
    or die "Could not open chef log: $!";

my $last_dt;
my $last_duration;

while(<$chef_log>){
    next unless /\[(\S+)\] INFO:.*complete.*in ([\d\.]+) seconds/;
    $last_dt = $1;
    $last_duration = $2;
}

my $last_epoch = str2time($last_dt);

printf "Chef ran %d seconds ago and took %.2f seconds\n", time - $last_epoch, $last_duration;
